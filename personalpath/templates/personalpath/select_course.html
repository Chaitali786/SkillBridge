{% extends 'base.html' %}

{% block title %}Select Course{% endblock %}

{% block content %}
<div class="jumbotron">
    <div class="container mt-4">
        <h1>Set your goals</h1>
        <h3>Choose Course</h3>
        <form method="post" id="course-selection-form">
            {% csrf_token %}
            <div class="row mb-4">
                <div class="col-md-6">
                    <select id="level-select" class="form-control" name="level">
                        <option value="" selected disabled>Select Level</option>
                        {% for level in levels %}
                        <option value="{{ level.name }}">{{ level.name|capfirst }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="row">
                {% for category, category_display in categories %}
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card">
                        <div class="card-header text-white" style="background-color: #178C8C;">
                            <h5>{{ category_display }}</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-group category-list" data-category="{{ category }}">
                                {% for course in courses %}
                                {% if course.category == category %}
                                <li class="list-group-item course-item" data-course-id="{{ course.id }}" data-level="{{ course.difficulty_level }}">
                                    {{ course.title }}
                                </li>
                                {% endif %}
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="text-right">
                <button type="submit" class="btn btn-primary btn-lg mt-4" style="width: 200px;">Next</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const levelSelect = document.getElementById('level-select');
        const categoryLists = document.querySelectorAll('.category-list');

        levelSelect.addEventListener('change', function () {
            const selectedLevel = this.value;
            categoryLists.forEach(list => {
                const category = list.dataset.category;
                const courseItems = list.querySelectorAll('.course-item');
                courseItems.forEach(item => {
                    if (item.dataset.level === selectedLevel || selectedLevel === '') {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                        item.classList.remove('selected');
                    }
                });
            });
        });

        const courseItems = document.querySelectorAll('.course-item');
        courseItems.forEach(item => {
        item.addEventListener('click', function () {
            // Toggle selection only if no course is selected yet
            if (!document.querySelector('.course-item.selected')) {
            this.classList.toggle('selected');
            // Disable all other course items after selecting one
            courseItems.forEach(otherItem => {
                if (otherItem !== item) {
                otherItem.disabled = true;
                }
            });
            }
        });
        });

        // Add a hidden input field to store the selected course ids
        const form = document.querySelector('#course-selection-form');
        form.addEventListener('submit', function (event) {
            const selectedCourses = document.querySelectorAll('.course-item.selected');
            if (selectedCourses.length === 0) {
                event.preventDefault();
                alert('Please select at least one course.');
                return;
            }
            selectedCourses.forEach(course => {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'course_ids';
                input.value = course.dataset.courseId;
                form.appendChild(input);
            });
        });
    });

    // Add styles for selected course items and cursor change
    const style = document.createElement('style');
    style.innerHTML = `
        .course-item {
            cursor: pointer;
        }
        .course-item.selected {
            background-color: #178C8C;
            color: white;
        }
    `;
    document.head.appendChild(style);
</script>
{% endblock %}
